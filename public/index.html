<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Formular zur Abizeitung</title>
</head>

<body class="bg-light">
    <div class="container">
        <main>
            <div class="py-5 text-center">
                <h2>Formular zur Abizeitung</h2>
                <p>Auf dieser Seite sollen Textfelder ausgefüllt werden, um die für jeden Schüler benötigten Daten
                    sammeln
                    zu können.</p>
            </div>
            <div class="container">
                <form class="needs-validation" novalidate>
                    <div class="row g-3">
                        <div class="col-sm-6">
                            <label for="vorname" class="form-label">Vorname</label>
                            <input type="text" class="form-control" id="vorname" placeholder="Vorname" required>
                            <div class="invalid-feedback">Bitte gib den Vornamen der Person ein.</div>
                        </div>
                        <div class="col-sm-6">
                            <label for="token" class="form-label">Token</label>
                            <input type="text" class="form-control" id="token" placeholder="Token" required>
                            <div class="invalid-feedback">Bitte gib den Authentifizierungs-Token der Person ein.</div>
                        </div>
                        <div class="col-12">
                            <label for="spitzname" class="form-label">Spitzname/n</label>
                            <input type="text" class="form-control" id="spitzname" placeholder="Spitzname/n" required>
                            <div class="invalid-feedback">Bitte gib einen Spitznamen ein. Sollten keine Spitznamen für
                                diese Person existieren, trage bitte 'Keine' ein.</div>
                        </div>
                        <div class="col-12">
                            <label for="geburtsdatum" class="form-label">Geburtsdatum</label>
                            <input type="text" class="form-control" id="geburtsdatum" placeholder="Geburtsdatum"
                                required>
                            <div class="invalid-feedback">Bitte gib ein Geburtsdatum ein.</div>
                        </div>
                        <div class="col-12">
                            <label for="berufswunsch" class="form-label">Berufswunsch/wünsche</label>
                            <input type="text" class="form-control" id="berufswunsch" placeholder="Berufswunsch/wünsche"
                                required>
                            <div class="invalid-feedback">Bitte gib einen Berufswunsch ein. Sollten keine aktiven
                                Berufswünsche bestehen, trage bitte 'Keine' ein.</div>
                        </div>
                        <div class="padding"></div>
                        <button type="submit" class="btn btn-primary">Speichern</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-analytics.js";
        import { signInAnonymously, getAuth } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAfYqX4XPmgJ3lWdzc66lAuGEHVWhjdr3s",
            authDomain: "gympeg-abizeitung.firebaseapp.com",
            projectId: "gympeg-abizeitung",
            storageBucket: "gympeg-abizeitung.appspot.com",
            messagingSenderId: "232535777638",
            appId: "1:232535777638:web:ad2eb5602fa8d3a89128a7",
            measurementId: "G-YM1XGVZFQY"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const firestore = getFirestore(app);

        const sendData = async (token, data) => {
            const credential = await signInAnonymously(auth);
            const entryDataCollection = collection(firestore, 'entrydata');
            const document = doc(entryDataCollection, token);
            await setDoc(document, data);
        };

        const value = (name) => {
            return document.getElementById(name).value;
        };

        window.onload = () => {
            const forms = document.querySelectorAll('.needs-validation');
            forms.forEach((form) => {
                form.addEventListener('submit', (event) => {
                    event.preventDefault();
                    event.stopPropagation();

                    if (form.checkValidity()) {
                        const token = value('token');
                        const fields = ['vorname', 'spitzname', 'geburtsdatum', 'berufswunsch'];

                        const data = {};
                        fields.forEach((field) => { data[field] = value(field); })

                        sendData(token, data);
                    }

                    form.classList.add('was-validated');
                }, false);
            });
        };
    </script>
</body>

</html>